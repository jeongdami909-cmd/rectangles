<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Windows - Poetic Blind Archive</title>
    <style>
        :root {
            --glass-bg: rgba(30, 30, 30, 0.3); /* ì´ë¯¸ì§€ ê°ì„±ì— ë§ì¶˜ ì–´ë‘ìš´ ë°˜íˆ¬ëª… */
            --btn-bg: rgba(255, 255, 255, 0.15);
            --text-color: rgba(255, 255, 255, 0.95);
        }

        body {
            margin: 0; padding: 0;
            background-color: #111;
            font-family: 'Pretendard', 'Apple SD Gothic Neo', sans-serif;
            min-height: 100vh;
            display: flex; flex-direction: column; align-items: center;
        }

        /* ğŸŒ† ì „ì²´ ë°°ê²½ ì‚¬ì§„ */
        .site-bg {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-size: cover; background-position: center;
            opacity: 0.5; z-index: -2;
            transition: background-image 0.8s ease;
        }

        /* ğŸŒ‘ ë°°ê²½ ê´€ë¦¬ ë©”ë‰´ */
        .bg-admin {
            position: fixed; bottom: 20px; right: 20px;
            z-index: 1000; display: flex; gap: 8px;
        }
        .bg-admin label, .bg-admin button {
            cursor: pointer; background: var(--btn-bg);
            color: rgba(255, 255, 255, 0.7); font-size: 11px;
            padding: 8px 14px; border-radius: 4px;
            backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px);
            border: 1px solid rgba(255,255,255,0.1); outline: none;
        }

        /* ğŸªŸ ê°¤ëŸ¬ë¦¬ ê·¸ë¦¬ë“œ (2ì—´ êµ¬ì¡°) */
        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            width: 100%; max-width: 600px; /* ëª¨ë°”ì¼/íƒœë¸”ë¦¿ ë³´ê¸° ì¢‹ì€ ì‚¬ì´ì¦ˆ */
            padding: 60px 20px 120px 20px; 
            box-sizing: border-box; z-index: 10;
        }

        /* ğŸƒ ê°œë³„ ì¹´ë“œ (ê²Œì‹œíŒ) */
        .card {
            position: relative;
            width: 100%;
            aspect-ratio: 3 / 4.5; /* ì„¸ë¡œë¡œ ê¸´ ì‹œì ì¸ ë¹„ìœ¨ */
            border-radius: 6px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            background: #222;
        }

        /* ğŸ“¸ ë ˆì´ì–´ 1: ë§¨ ë°‘ì˜ ì‚¬ì§„ */
        .photo-layer {
            position: absolute; inset: 0; z-index: 1;
        }
        .photo-layer img {
            width: 100%; height: 100%; object-fit: cover;
        }

        /* ğŸŒ«ï¸ ë ˆì´ì–´ 2: ë¸”ë¼ì¸ë“œ (ê¸€ ì“°ëŠ” ë°˜íˆ¬ëª… ì˜ì—­) */
        .blind-layer {
            position: absolute; inset: 0; z-index: 2;
            background: linear-gradient(to bottom, rgba(0,0,0,0.1) 0%, rgba(0,0,0,0.5) 100%);
            backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
            display: flex; flex-direction: column; justify-content: flex-end; /* ê¸€ì”¨ê°€ ì•„ë˜ë¡œ ê°€ë„ë¡ */
            padding: 25px 20px;
            transition: transform 0.7s cubic-bezier(0.65, 0, 0.15, 1); /* ìŠ¤ë¥´ë¥µ ì˜¬ë¼ê°€ëŠ” ì• ë‹ˆë©”ì´ì…˜ */
            border-bottom: 2px solid rgba(255,255,255,0.2); /* ë¸”ë¼ì¸ë“œ ëìë½ ëŠë‚Œ */
        }

        /* ğŸ”¼ ë¸”ë¼ì¸ë“œê°€ ì˜¬ë¼ê°„ ìƒíƒœ */
        .card.lifted .blind-layer {
            transform: translateY(-100%); /* ìœ„ë¡œ ì™„ì „íˆ ë§ë ¤ ì˜¬ë¼ê° */
        }

        /* ğŸ“œ í…ìŠ¤íŠ¸ ì—ë””í„° */
        .blind-layer h3 {
            margin: 0 0 10px 0; font-size: 1.1em; color: var(--text-color);
            font-weight: 600; text-shadow: 0 2px 4px rgba(0,0,0,0.6); outline: none;
        }
        .blind-layer p {
            margin: 0; font-size: 0.95em; line-height: 1.6; color: rgba(255,255,255,0.85);
            text-shadow: 0 2px 4px rgba(0,0,0,0.6); outline: none; white-space: pre-wrap;
            max-height: 150px; overflow-y: auto;
        }

        /* ğŸ”˜ ì‘ê³  ë°˜íˆ¬ëª…í•œ ë²„íŠ¼ ê·¸ë£¹ (ìµœìƒë‹¨) */
        .btn-group {
            position: absolute; top: 10px; right: 10px; z-index: 10;
            display: flex; gap: 4px; flex-wrap: wrap; justify-content: flex-end; width: 80%;
            opacity: 0.2; transition: opacity 0.3s;
        }
        .card:hover .btn-group { opacity: 1; } /* ë§ˆìš°ìŠ¤ ì˜¬ë¦¬ë©´ ë²„íŠ¼ ë³´ì„ */

        .mini-btn {
            background: var(--btn-bg); border: 1px solid rgba(255,255,255,0.1);
            color: rgba(255,255,255,0.9); font-size: 10px; padding: 4px 8px;
            border-radius: 4px; cursor: pointer; backdrop-filter: blur(4px);
        }
        .mini-btn:hover { background: rgba(255,255,255,0.3); }

        /* â• ì°½ë¬¸ ì„¸íŠ¸ ì¶”ê°€ ë²„íŠ¼ */
        .add-btn {
            background: rgba(0,0,0,0.4); border: 1px solid rgba(255,255,255,0.1);
            color: #fff; padding: 12px 40px; border-radius: 30px; cursor: pointer;
            font-size: 13px; letter-spacing: 1px; backdrop-filter: blur(10px);
            margin-bottom: 50px;
        }

        input[type="file"] { display: none; }
        
        /* ìŠ¤í¬ë¡¤ë°” ì»¤ìŠ¤í…€ */
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.3); border-radius: 4px; }
    </style>
</head>
<body>

<div class="site-bg" id="bgLayer"></div>

<div class="bg-admin">
    <label for="bgUpload">ë°°ê²½ ë³€ê²½</label>
    <button onclick="fixBg()">ë°°ê²½ ê³ ì •</button>
    <input type="file" id="bgUpload" accept="image/*">
</div>

<div class="gallery-grid" id="mainGrid"></div>

<button class="add-btn" onclick="addPair()">+ ìƒˆë¡œìš´ ê¸°ì–µ ì¶”ê°€</button>

<script>
    const grid = document.getElementById('mainGrid');
    const bgLayer = document.getElementById('bgLayer');

    // 1. ë°°ê²½ ê³ ì • ê´€ë¦¬
    const savedBg = localStorage.getItem('blind-bg-fixed');
    if (savedBg) bgLayer.style.backgroundImage = `url(${savedBg})`;

    document.getElementById('bgUpload').addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = (ev) => { bgLayer.style.backgroundImage = `url(${ev.target.result})`; };
            reader.readAsDataURL(file);
        }
    });

    function fixBg() {
        const bgImg = bgLayer.style.backgroundImage;
        if (bgImg && bgImg !== 'none') {
            const url = bgImg.replace(/^url\(["']?/, '').replace(/["']?\)$/, '');
            try {
                localStorage.setItem('blind-bg-fixed', url);
                alert('ë°°ê²½ì´ ê³ ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
            } catch(e) { alert('ìš©ëŸ‰ ì´ˆê³¼ë¡œ ì €ì¥í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'); }
        }
    }

    // 2. ê²Œì‹œíŒ(ì¹´ë“œ) ë¦¬ìŠ¤íŠ¸ ê´€ë¦¬
    let boardList = JSON.parse(localStorage.getItem('blind-board-list')) || [1, 2, 3, 4];
    let nextId = parseInt(localStorage.getItem('blind-next-id')) || 5;

    function render() {
        grid.innerHTML = '';
        boardList.forEach(id => createBoard(id));
    }

    function createBoard(id) {
        const card = document.createElement('div');
        card.className = 'card';
        card.id = `card-${id}`;
        
        const saved = JSON.parse(localStorage.getItem(`blind-data-${id}`)) || 
                     { title: `ê¸°ì–µ ì¡°ê° ${id}`, text: 'ì—¬ê¸°ì— ì‹œë¥¼ ì ì–´ë³´ì„¸ìš”.', img: '' };

        card.innerHTML = `
            <div class="btn-group">
                <button class="mini-btn" onclick="toggleBlind(${id}, event)">ë¸”ë¼ì¸ë“œ</button>
                <button class="mini-btn" onclick="triggerPhoto(${id}, event)">ì‚¬ì§„</button>
                <button class="mini-btn" onclick="editContent(${id}, event)">ìˆ˜ì •</button>
                <button class="mini-btn" onclick="saveData(${id}, event)">ê³ ì •</button>
                <button class="mini-btn" onclick="deleteBoard(${id}, event)">ì‚­ì œ</button>
            </div>
            
            <input type="file" id="file-${id}" accept="image/*">
            
            <div class="photo-layer">
                <img src="${saved.img}" id="img-${id}" style="${saved.img ? 'display:block' : 'display:none'}">
            </div>
            
            <div class="blind-layer" onclick="event.stopPropagation()">
                <h3 contenteditable="true" id="title-${id}">${saved.title}</h3>
                <p contenteditable="true" id="text-${id}">${saved.text}</p>
            </div>
        `;

        grid.appendChild(card);

        // ì‚¬ì§„ ì—…ë¡œë“œ ì²˜ë¦¬
        document.getElementById(`file-${id}`).addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (ev) => {
                    const img = document.getElementById(`img-${id}`);
                    img.src = ev.target.result;
                    img.style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        });
    }

    // ğŸªŸ ë¸”ë¼ì¸ë“œ ì˜¬ë¦¬ê¸°/ë‚´ë¦¬ê¸°
    function toggleBlind(id, e) {
        e.stopPropagation();
        document.getElementById(`card-${id}`).classList.toggle('lifted');
    }

    // ğŸ“¸ ì‚¬ì§„ ë„£ê¸°
    function triggerPhoto(id, e) {
        e.stopPropagation();
        document.getElementById(`file-${id}`).click();
    }

    // âœï¸ ìˆ˜ì • (ì œëª©ì— í¬ì»¤ìŠ¤)
    function editContent(id, e) {
        e.stopPropagation();
        const card = document.getElementById(`card-${id}`);
        card.classList.remove('lifted'); // ê¸€ì„ ì¨ì•¼ í•˜ë‹ˆ ë¸”ë¼ì¸ë“œë¥¼ ë‚´ë¦¼
        document.getElementById(`title-${id}`).focus();
    }

    // ğŸ’¾ ë°ì´í„° ê³ ì •
    function saveData(id, e) {
        e.stopPropagation();
        const imgEl = document.getElementById(`img-${id}`);
        const title = document.getElementById(`title-${id}`).innerText;
        const text = document.getElementById(`text-${id}`).innerText;
        const img = imgEl.src && imgEl.src.startsWith('data:') ? imgEl.src : '';

        try {
            localStorage.setItem(`blind-data-${id}`, JSON.stringify({ title, text, img }));
            alert('ê¸°ì–µì´ ê³ ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
        } catch(err) {
            alert('ì €ì¥ ìš©ëŸ‰ì´ ë¶€ì¡±í•©ë‹ˆë‹¤. ì‚¬ì§„ í¬ê¸°ë¥¼ ì¤„ì—¬ì£¼ì„¸ìš”.');
        }
    }

    // ğŸ—‘ï¸ ê²Œì‹œíŒ ì‚­ì œ
    function deleteBoard(id, e) {
        e.stopPropagation();
        if(confirm('ì´ ê¸°ë¡ì„ ì§€ìš°ì‹œê² ìŠµë‹ˆê¹Œ?')) {
            localStorage.removeItem(`blind-data-${id}`);
            document.getElementById(`card-${id}`).remove();
            boardList = boardList.filter(item => item !== id);
            localStorage.setItem('blind-board-list', JSON.stringify(boardList));
        }
    }

    // â• ìƒˆë¡œìš´ ì¹´ë“œ ì„¸íŠ¸ ì¶”ê°€
    function addPair() {
        const id1 = nextId++;
        const id2 = nextId++;
        boardList.push(id1, id2);
        localStorage.setItem('blind-board-list', JSON.stringify(boardList));
        localStorage.setItem('blind-next-id', nextId);
        createBoard(id1);
        createBoard(id2);
        window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
    }

    render();
</script>
</body>
</html>
