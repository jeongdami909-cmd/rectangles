<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Windows - Light Gray Frosted Blind</title>
    <style>
        :root {
            --indigo: #3f51b5;
            --btn-bg: rgba(255, 255, 255, 0.15);
        }

        body {
            margin: 0; padding: 0;
            background-color: transparent; /* ì‚¬ì´íŠ¸ ì „ì²´ ì™„ì „ íˆ¬ëª… */
            font-family: 'Pretendard', 'Apple SD Gothic Neo', sans-serif;
            min-height: 100vh;
            display: flex; flex-direction: column; align-items: center;
        }

        /* ğŸŒ† ì „ì²´ ë°°ê²½ ì‚¬ì§„ */
        .site-bg {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-size: cover; background-position: center;
            opacity: 1; z-index: -2;
            transition: background-image 0.8s ease;
        }

        /* ğŸŒ‘ í•˜ë‹¨ ê´€ë¦¬ ë©”ë‰´ */
        .bg-admin {
            position: fixed; bottom: 20px; right: 20px;
            z-index: 1000; display: flex; gap: 8px; flex-wrap: wrap; justify-content: flex-end;
            max-width: 300px;
        }
        .bg-admin label, .bg-admin button {
            cursor: pointer; background: rgba(0, 0, 0, 0.4);
            color: rgba(255, 255, 255, 0.9); font-size: 11px;
            padding: 8px 14px; border-radius: 4px;
            backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px);
            border: 1px solid rgba(255,255,255,0.2); outline: none;
        }
        .bg-admin .danger-btn { color: #ff8a80; border-color: rgba(255,138,128,0.4); }

        /* ğŸªŸ ê°¤ëŸ¬ë¦¬ ê·¸ë¦¬ë“œ (2ì—´) - ë°°ê²½ì´ ì˜ ë³´ì´ë„ë¡ ìƒë‹¨ ì—¬ë°± 250pxë¡œ ëŒ€í­ í™•ëŒ€ */
        .gallery-grid {
            display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px;
            width: 100%; max-width: 600px; 
            padding: 250px 20px 120px 20px; /* ê¸°ì¡´ 60px -> 250px */
            box-sizing: border-box; z-index: 10;
        }

        /* ğŸƒ ê°œë³„ ì¹´ë“œ (ë³¸ì²´ëŠ” íˆ¬ëª…) */
        .card {
            position: relative; width: 100%; aspect-ratio: 3 / 4.5; 
            border-radius: 6px; overflow: hidden;
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.1); /* ì¹´ë“œ í…Œë‘ë¦¬ë§Œ ì‚´ì§ */
        }

        /* ğŸ“¸ ì‚¬ì§„ ë ˆì´ì–´ (ì™„ì „ íˆ¬ëª…) */
        .photo-layer { position: absolute; inset: 0; z-index: 1; background: transparent; }
        .photo-layer img { width: 100%; height: 100%; object-fit: cover; }

        /* ğŸŒ«ï¸ ë¸”ë¼ì¸ë“œ ë ˆì´ì–´ (ì—·ì€ íšŒìƒ‰ ë°˜íˆ¬ëª…) */
        .blind-layer {
            position: absolute; inset: 0; z-index: 2;
            background-color: rgba(240, 240, 240, 0.35); /* ì—·ì€ íšŒìƒ‰ ë°˜íˆ¬ëª… */
            backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); /* ì„œë¦¬ê°€ ë‚€ ë“¯í•œ ë¸”ëŸ¬ íš¨ê³¼ */
            display: flex; flex-direction: column; justify-content: flex-end; 
            padding: 25px 20px;
            transition: transform 0.7s cubic-bezier(0.65, 0, 0.15, 1); 
            border-bottom: 2px solid rgba(255,255,255,0.4); 
        }

        .card.lifted .blind-layer { transform: translateY(-100%); }

        /* ğŸ“œ í…ìŠ¤íŠ¸ ì—ë””í„° (ë°ì€ ë°°ê²½ì— ë§ì¶° ì–´ë‘ìš´ ê¸€ì”¨ë¡œ ë³€ê²½) */
        .blind-layer h3 {
            margin: 0 0 10px 0; font-size: 1.1em; color: var(--indigo);
            font-weight: 600; outline: none;
        }
        .blind-layer p {
            margin: 0; font-size: 0.95em; line-height: 1.6; color: #222; /* ì§„í•œ íšŒí‘ìƒ‰ í…ìŠ¤íŠ¸ */
            outline: none; white-space: pre-wrap;
            max-height: 150px; overflow-y: auto;
        }

        /* ğŸ”˜ ë°˜íˆ¬ëª… ë²„íŠ¼ ê·¸ë£¹ */
        .btn-group {
            position: absolute; top: 10px; right: 10px; z-index: 10;
            display: flex; gap: 4px; flex-wrap: wrap; justify-content: flex-end; width: 80%;
            opacity: 0; transition: opacity 0.3s; /* í‰ì†Œì—” ìˆ¨ê¹€ */
        }
        .card:hover .btn-group, .card:active .btn-group { opacity: 1; } 

        .mini-btn {
            background: rgba(0,0,0,0.4); border: 1px solid rgba(255,255,255,0.2);
            color: rgba(255,255,255,0.9); font-size: 10px; padding: 5px 9px;
            border-radius: 4px; cursor: pointer; backdrop-filter: blur(4px);
        }
        .mini-btn:hover { background: rgba(0,0,0,0.6); }

        .add-btn {
            background: rgba(0,0,0,0.5); border: 1px solid rgba(255,255,255,0.3);
            color: #fff; padding: 12px 40px; border-radius: 30px; cursor: pointer;
            font-size: 13px; letter-spacing: 1px; backdrop-filter: blur(8px);
            margin-bottom: 50px; box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        input[type="file"] { display: none; }
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.2); border-radius: 4px; }
    </style>
</head>
<body>

<div class="site-bg" id="bgLayer"></div>

<div class="bg-admin">
    <label for="bgUpload">ë°°ê²½ ë³€ê²½</label>
    <button onclick="fixBg()">ë°°ê²½ ê³ ì •</button>
    <button class="danger-btn" onclick="hardReset()">ğŸ§¹ ì „ì²´ ì´ˆê¸°í™”</button>
    <input type="file" id="bgUpload" accept="image/*">
</div>

<div class="gallery-grid" id="mainGrid"></div>

<button class="add-btn" onclick="addPair()">+ ìƒˆë¡œìš´ ê¸°ì–µ ì¶”ê°€</button>

<script>
    const grid = document.getElementById('mainGrid');
    const bgLayer = document.getElementById('bgLayer');

    // ğŸ”§ ì´ë¯¸ì§€ ìë™ ì••ì¶• í•¨ìˆ˜
    function compressImage(file, maxWidth, quality, callback) {
        const reader = new FileReader();
        reader.onload = function(event) {
            const img = new Image();
            img.onload = function() {
                const canvas = document.createElement('canvas');
                let width = img.width;
                let height = img.height;

                if (width > maxWidth) {
                    height = Math.round((height *= maxWidth / width));
                    width = maxWidth;
                }

                canvas.width = width;
                canvas.height = height;
                const ctx = canvas.getContext('2d');
                ctx.drawImage(img, 0, 0, width, height);
                
                const compressedDataUrl = canvas.toDataURL('image/jpeg', quality);
                callback(compressedDataUrl);
            };
            img.src = event.target.result;
        };
        reader.readAsDataURL(file);
    }

    // 1. ë°°ê²½ ì„¤ì •
    const savedBg = localStorage.getItem('blind-bg-fixed');
    if (savedBg) bgLayer.style.backgroundImage = `url(${savedBg})`;

    document.getElementById('bgUpload').addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (file) {
            compressImage(file, 1200, 0.7, (compressedUrl) => {
                bgLayer.style.backgroundImage = `url(${compressedUrl})`;
            });
        }
    });

    function fixBg() {
        const bgImg = bgLayer.style.backgroundImage;
        if (bgImg && bgImg !== 'none') {
            const url = bgImg.replace(/^url\(["']?/, '').replace(/["']?\)$/, '');
            try {
                localStorage.setItem('blind-bg-fixed', url);
                alert('ë°°ê²½ì´ ê³ ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
            } catch(e) { alert('ìš©ëŸ‰ ì´ˆê³¼ë¡œ ì €ì¥í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (ì „ì²´ ì´ˆê¸°í™” ê¶Œì¥)'); }
        }
    }

    // 2. ê²Œì‹œíŒ ë¦¬ìŠ¤íŠ¸ ê´€ë¦¬
    let boardList = JSON.parse(localStorage.getItem('blind-board-list')) || [1, 2, 3, 4];
    let nextId = parseInt(localStorage.getItem('blind-next-id')) || 5;

    function render() {
        grid.innerHTML = '';
        boardList.forEach(id => createBoard(id));
    }

    function createBoard(id) {
        const card = document.createElement('div');
        card.className = 'card';
        card.id = `card-${id}`;
        
        const saved = JSON.parse(localStorage.getItem(`blind-data-${id}`)) || 
                     { title: `ê¸°ì–µ ì¡°ê° ${id}`, text: 'ì—¬ê¸°ì— ì‹œë¥¼ ì ì–´ë³´ì„¸ìš”.', img: '' };

        card.innerHTML = `
            <div class="btn-group">
                <button class="mini-btn" onclick="toggleBlind(${id}, event)">ë¸”ë¼ì¸ë“œ</button>
                <button class="mini-btn" onclick="triggerPhoto(${id}, event)">ì‚¬ì§„</button>
                <button class="mini-btn" onclick="editContent(${id}, event)">ìˆ˜ì •</button>
                <button class="mini-btn" onclick="saveData(${id}, event)">ê³ ì •</button>
                <button class="mini-btn" onclick="deleteBoard(${id}, event)">ì‚­ì œ</button>
            </div>
            <input type="file" id="file-${id}" accept="image/*">
            <div class="photo-layer">
                <img src="${saved.img}" id="img-${id}" style="${saved.img ? 'display:block' : 'display:none'}">
            </div>
            <div class="blind-layer" onclick="event.stopPropagation()">
                <h3 contenteditable="true" id="title-${id}">${saved.title}</h3>
                <p contenteditable="true" id="text-${id}">${saved.text}</p>
            </div>
        `;

        grid.appendChild(card);

        document.getElementById(`file-${id}`).addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                compressImage(file, 800, 0.6, (compressedUrl) => {
                    const img = document.getElementById(`img-${id}`);
                    img.src = compressedUrl;
                    img.style.display = 'block';
                });
            }
        });
    }

    function toggleBlind(id, e) {
        e.stopPropagation();
        document.getElementById(`card-${id}`).classList.toggle('lifted');
    }

    function triggerPhoto(id, e) {
        e.stopPropagation();
        document.getElementById(`file-${id}`).click();
    }

    function editContent(id, e) {
        e.stopPropagation();
        const card = document.getElementById(`card-${id}`);
        card.classList.remove('lifted');
        document.getElementById(`title-${id}`).focus();
    }

    function saveData(id, e) {
        e.stopPropagation();
        const imgEl = document.getElementById(`img-${id}`);
        const title = document.getElementById(`title-${id}`).innerText;
        const text = document.getElementById(`text-${id}`).innerText;
        const img = imgEl.src && imgEl.src.startsWith('data:') ? imgEl.src : '';

        try {
            localStorage.setItem(`blind-data-${id}`, JSON.stringify({ title, text, img }));
            alert('ê¸°ì–µì´ ê³ ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
        } catch(err) {
            alert('ì €ì¥ ìš©ëŸ‰ì´ ë¶€ì¡±í•©ë‹ˆë‹¤. í•˜ë‹¨ì˜ [ğŸ§¹ ì „ì²´ ì´ˆê¸°í™”]ë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš”.');
        }
    }

    function deleteBoard(id, e) {
        e.stopPropagation();
        if(confirm('ì´ ê¸°ë¡ì„ ì§€ìš°ì‹œê² ìŠµë‹ˆê¹Œ?')) {
            localStorage.removeItem(`blind-data-${id}`);
            document.getElementById(`card-${id}`).remove();
            boardList = boardList.filter(item => item !== id);
            localStorage.setItem('blind-board-list', JSON.stringify(boardList));
        }
    }

    function addPair() {
        const id1 = nextId++;
        const id2 = nextId++;
        boardList.push(id1, id2);
        localStorage.setItem('blind-board-list', JSON.stringify(boardList));
        localStorage.setItem('blind-next-id', nextId);
        createBoard(id1);
        createBoard(id2);
        window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
    }

    function hardReset() {
        if(confirm('ì£¼ì˜! ì €ì¥ëœ ëª¨ë“  ì‚¬ì§„ê³¼ ê¸€, ë°°ê²½ì´ ì‚­ì œë©ë‹ˆë‹¤. ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
            localStorage.clear();
            location.reload();
        }
    }

    render();
</script>
</body>
</html>
