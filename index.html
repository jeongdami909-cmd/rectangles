<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Windows - Light Gray Frosted Blind (Weather Edition Pro)</title>
    <style>
        :root {
            --indigo: #3f51b5;
            --btn-bg: rgba(255, 255, 255, 0.15);
        }

        body {
            margin: 0; padding: 0;
            background-color: transparent;
            font-family: 'Pretendard', 'Apple SD Gothic Neo', sans-serif;
            min-height: 100vh;
            display: flex; flex-direction: column; align-items: center;
            overflow-x: hidden;
        }

        /* ğŸŒ† ì „ì²´ ë°°ê²½ ì‚¬ì§„ */
        .site-bg {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-size: cover; background-position: center;
            opacity: 1; z-index: -3;
            transition: background-image 0.8s ease;
        }

        /* â„ï¸ ë‚ ì”¨ ì• ë‹ˆë©”ì´ì…˜ ìº”ë²„ìŠ¤ ë ˆì´ì–´ */
        #weather-canvas {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; 
            z-index: -1;
        }

        /* ğŸŒ‘ í•˜ë‹¨ ê´€ë¦¬ ë©”ë‰´ */
        .bg-admin {
            position: fixed; bottom: 20px; right: 20px;
            z-index: 1000; display: flex; gap: 8px; flex-wrap: wrap; justify-content: flex-end;
            max-width: 350px;
        }
        .bg-admin label, .bg-admin button, .bg-admin select {
            cursor: pointer; background: rgba(0, 0, 0, 0.5);
            color: rgba(255, 255, 255, 0.9); font-size: 11px;
            padding: 8px 14px; border-radius: 4px;
            backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px);
            border: 1px solid rgba(255,255,255,0.2); outline: none;
        }
        .bg-admin .danger-btn { color: #ff8a80; border-color: rgba(255,138,128,0.4); }

        /* ğŸªŸ ê°¤ëŸ¬ë¦¬ ê·¸ë¦¬ë“œ */
        .gallery-grid {
            display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px;
            width: 100%; max-width: 600px; 
            padding: 55vh 20px 120px 20px;
            box-sizing: border-box; z-index: 10;
        }

        /* ğŸƒ ê°œë³„ ì¹´ë“œ */
        .card {
            position: relative; width: 100%; aspect-ratio: 3 / 4.5; 
            border-radius: 6px; overflow: hidden;
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .photo-layer { position: absolute; inset: 0; z-index: 1; background: transparent; }
        .photo-layer img { width: 100%; height: 100%; object-fit: cover; }

        .blind-layer {
            position: absolute; inset: 0; z-index: 2;
            background-color: rgba(240, 240, 240, 0.35); 
            backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
            display: flex; flex-direction: column; justify-content: flex-end; 
            padding: 25px 20px;
            transition: transform 0.7s cubic-bezier(0.65, 0, 0.15, 1); 
            border-bottom: 2px solid rgba(255,255,255,0.4); 
        }

        .card.lifted .blind-layer { transform: translateY(-100%); }

        .blind-layer h3 {
            margin: 0 0 10px 0; font-size: 1.1em; color: var(--indigo);
            font-weight: 600; outline: none;
        }
        .blind-layer p {
            margin: 0; font-size: 0.95em; line-height: 1.6; color: #222;
            outline: none; white-space: pre-wrap;
            max-height: 150px; overflow-y: auto;
        }

        .btn-group {
            position: absolute; top: 10px; right: 10px; z-index: 10;
            display: flex; gap: 4px; flex-wrap: wrap; justify-content: flex-end; width: 80%;
            opacity: 0; transition: opacity 0.3s;
        }
        .card:hover .btn-group, .card:active .btn-group { opacity: 1; } 

        .mini-btn {
            background: rgba(0,0,0,0.4); border: 1px solid rgba(255,255,255,0.2);
            color: rgba(255,255,255,0.9); font-size: 10px; padding: 5px 9px;
            border-radius: 4px; cursor: pointer; backdrop-filter: blur(4px);
        }

        .add-btn {
            background: rgba(0,0,0,0.5); border: 1px solid rgba(255,255,255,0.3);
            color: #fff; padding: 12px 40px; border-radius: 30px; cursor: pointer;
            font-size: 13px; letter-spacing: 1px; backdrop-filter: blur(8px);
            margin-bottom: 50px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); z-index: 100;
        }

        input[type="file"] { display: none; }
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.2); border-radius: 4px; }
    </style>
</head>
<body>

<div class="site-bg" id="bgLayer"></div>
<canvas id="weather-canvas"></canvas>

<div class="bg-admin">
    <select id="weatherSelect">
        <option value="none">ë‚ ì”¨ ì—†ìŒ</option>
        <option value="snow">â„ï¸ ëˆˆ ë‚´ë¦¬ëŠ” ë‚ </option>
        <option value="rain">ğŸŒ§ï¸ ë¹„ ì˜¤ëŠ” ë‚ </option>
        <option value="petals">ğŸŒ¸ ê½ƒì íœ˜ë‚ ë¦¬ëŠ” ë‚ </option>
        <option value="stars">âœ¨ ë³„ë¹› ë°˜ì§ì´ëŠ” ë°¤</option>
        <option value="rose">ğŸŒ¹ ì¥ë¯¸ íœ˜ë‚ ë¦¬ëŠ” ë‚ </option>
    </select>
    <label for="bgUpload">ë°°ê²½ ë³€ê²½</label>
    <button class="danger-btn" onclick="hardReset()">ğŸ§¹ ì „ì²´ ì´ˆê¸°í™”</button>
    <input type="file" id="bgUpload" accept="image/*">
</div>

<div class="gallery-grid" id="mainGrid"></div>
<button class="add-btn" onclick="addPair()">+ ìƒˆë¡œìš´ ê¸°ì–µ ì¶”ê°€</button>

<script>
    const grid = document.getElementById('mainGrid');
    const bgLayer = document.getElementById('bgLayer');
    const canvas = document.getElementById('weather-canvas');
    const ctx = canvas.getContext('2d');

    function compressImage(file, maxWidth, quality, callback) {
        const reader = new FileReader();
        reader.onload = function(event) {
            const img = new Image();
            img.onload = function() {
                const canvas = document.createElement('canvas');
                let width = img.width;
                let height = img.height;
                if (width > maxWidth) {
                    height = Math.round((height *= maxWidth / width));
                    width = maxWidth;
                }
                canvas.width = width;
                canvas.height = height;
                const ctx = canvas.getContext('2d');
                ctx.drawImage(img, 0, 0, width, height);
                const compressedDataUrl = canvas.toDataURL('image/jpeg', quality);
                callback(compressedDataUrl);
            };
            img.src = event.target.result;
        };
        reader.readAsDataURL(file);
    }

    const savedBg = localStorage.getItem('blind-bg-fixed');
    if (savedBg) bgLayer.style.backgroundImage = `url(${savedBg})`;

    document.getElementById('bgUpload').addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (file) {
            compressImage(file, 1200, 0.7, (compressedUrl) => {
                bgLayer.style.backgroundImage = `url(${compressedUrl})`;
                try {
                    localStorage.setItem('blind-bg-fixed', compressedUrl);
                } catch(err) { alert('ì €ì¥ ê³µê°„ ë¶€ì¡±'); }
            });
        }
    });

    let boardList = JSON.parse(localStorage.getItem('blind-board-list')) || [1, 2, 3, 4];
    let nextId = parseInt(localStorage.getItem('blind-next-id')) || 5;

    function render() {
        grid.innerHTML = '';
        boardList.forEach(id => createBoard(id));
    }

    function createBoard(id) {
        const card = document.createElement('div');
        card.className = 'card';
        card.id = `card-${id}`;
        const saved = JSON.parse(localStorage.getItem(`blind-data-${id}`)) || 
                     { title: `ê¸°ì–µ ì¡°ê° ${id}`, text: 'ì—¬ê¸°ì— ì‹œë¥¼ ì ì–´ë³´ì„¸ìš”.', img: '' };
        card.innerHTML = `
            <div class="btn-group">
                <button class="mini-btn" onclick="toggleBlind(${id}, event)">ë¸”ë¼ì¸ë“œ</button>
                <button class="mini-btn" onclick="triggerPhoto(${id}, event)">ì‚¬ì§„</button>
                <button class="mini-btn" onclick="editContent(${id}, event)">ìˆ˜ì •</button>
                <button class="mini-btn" onclick="saveData(${id}, event)">ê³ ì •</button>
                <button class="mini-btn" onclick="deleteBoard(${id}, event)">ì‚­ì œ</button>
            </div>
            <input type="file" id="file-${id}" accept="image/*">
            <div class="photo-layer">
                <img src="${saved.img}" id="img-${id}" style="${saved.img ? 'display:block' : 'display:none'}">
            </div>
            <div class="blind-layer" onclick="event.stopPropagation()">
                <h3 contenteditable="true" id="title-${id}">${saved.title}</h3>
                <p contenteditable="true" id="text-${id}">${saved.text}</p>
            </div>
        `;
        grid.appendChild(card);
        document.getElementById(`file-${id}`).addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                compressImage(file, 800, 0.6, (compressedUrl) => {
                    const img = document.getElementById(`img-${id}`);
                    img.src = compressedUrl;
                    img.style.display = 'block';
                });
            }
        });
    }

    function toggleBlind(id, e) { e.stopPropagation(); document.getElementById(`card-${id}`).classList.toggle('lifted'); }
    function triggerPhoto(id, e) { e.stopPropagation(); document.getElementById(`file-${id}`).click(); }
    function editContent(id, e) { e.stopPropagation(); document.getElementById(`title-${id}`).focus(); }
    function saveData(id, e) {
        e.stopPropagation();
        const imgEl = document.getElementById(`img-${id}`);
        const title = document.getElementById(`title-${id}`).innerText;
        const text = document.getElementById(`text-${id}`).innerText;
        const img = imgEl.src && imgEl.src.startsWith('data:') ? imgEl.src : '';
        try {
            localStorage.setItem(`blind-data-${id}`, JSON.stringify({ title, text, img }));
            alert('ê³ ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
        } catch(err) { alert('ìš©ëŸ‰ ë¶€ì¡±'); }
    }
    function deleteBoard(id, e) {
        e.stopPropagation();
        if(confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
            localStorage.removeItem(`blind-data-${id}`);
            document.getElementById(`card-${id}`).remove();
            boardList = boardList.filter(item => item !== id);
            localStorage.setItem('blind-board-list', JSON.stringify(boardList));
        }
    }
    function addPair() {
        const id1 = nextId++; const id2 = nextId++;
        boardList.push(id1, id2);
        localStorage.setItem('blind-board-list', JSON.stringify(boardList));
        localStorage.setItem('blind-next-id', nextId);
        createBoard(id1); createBoard(id2);
    }
    function hardReset() { if(confirm('ì „ì²´ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) { localStorage.clear(); location.reload(); } }

    // â„ï¸ğŸŒ§ï¸ğŸŒ¸âœ¨ğŸŒ¹ ì—…ê·¸ë ˆì´ë“œ ë‚ ì”¨ ì—”ì§„
    let particles = [];
    let weatherType = 'none';

    function resize() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resize);
    resize();

    class Particle {
        constructor() { this.reset(); }
        reset() {
            this.x = Math.random() * canvas.width;
            this.y = Math.random() * canvas.height;
            this.size = Math.random() * 3 + 1;
            this.speed = Math.random() * 2 + 0.5;
            this.velY = this.speed;
            this.velX = Math.random() * 1 - 0.5;
            this.opacity = Math.random() * 0.5 + 0.3;
            this.angle = Math.random() * 360;
            this.spin = Math.random() * 2 - 1;
            this.twinkleSpeed = Math.random() * 0.02 + 0.01;
        }
        update() {
            if (weatherType === 'stars') {
                // ë³„ë¹›: ì œìë¦¬ì—ì„œ ë°˜ì§ì´ê±°ë‚˜ ì•„ì£¼ ë¯¸ì„¸í•˜ê²Œ ì´ë™
                this.opacity += this.twinkleSpeed;
                if (this.opacity > 0.8 || this.opacity < 0.2) this.twinkleSpeed *= -1;
                this.y += 0.1; 
            } else {
                this.y += this.velY;
                this.x += this.velX;
            }

            if (weatherType === 'snow') {
                this.velX = Math.sin(this.y * 0.01) * 0.5;
            } else if (weatherType === 'rain') {
                this.velY = this.speed * 5;
            } else if (weatherType === 'petals' || weatherType === 'rose') {
                this.velX = Math.cos(this.y * 0.005) * 1.5;
                this.angle += this.spin;
            }

            if (this.y > canvas.height) {
                this.y = -10;
                this.x = Math.random() * canvas.width;
            }
        }
        draw() {
            ctx.beginPath();
            if (weatherType === 'snow' || weatherType === 'stars') {
                ctx.fillStyle = `rgba(255, 255, 255, ${this.opacity})`;
                ctx.arc(this.x, this.y, this.size / (weatherType === 'stars' ? 1.5 : 1), 0, Math.PI * 2);
                ctx.fill();
            } else if (weatherType === 'rain') {
                ctx.strokeStyle = `rgba(255, 255, 255, 0.2)`;
                ctx.moveTo(this.x, this.y);
                ctx.lineTo(this.x, this.y + 10);
                ctx.stroke();
            } else if (weatherType === 'petals' || weatherType === 'rose') {
                ctx.save();
                ctx.translate(this.x, this.y);
                ctx.rotate(this.angle * Math.PI / 180);
                // ì¥ë¯¸ëŠ” ì§„í•œ ë¹¨ê°•, ê½ƒìì€ ì—°ë¶„í™
                ctx.fillStyle = weatherType === 'rose' ? `rgba(180, 0, 0, ${this.opacity})` : `rgba(255, 182, 193, ${this.opacity})`;
                ctx.ellipse(0, 0, this.size * 2, this.size, 0, 0, Math.PI * 2);
                ctx.fill();
                ctx.restore();
            }
        }
    }

    function initWeather(type) {
        weatherType = type;
        particles = [];
        if (type === 'none') return;
        let count = (type === 'rain' || type === 'stars') ? 150 : 80;
        for (let i = 0; i < count; i++) { particles.push(new Particle()); }
        // ğŸ’¡ ë‚ ì”¨ ê³ ì •: ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ì €ì¥
        localStorage.setItem('blind-weather-type', type);
    }

    function animate() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        if (weatherType !== 'none') {
            particles.forEach(p => { p.update(); p.draw(); });
        }
        requestAnimationFrame(animate);
    }

    // ğŸ’¡ ì´ˆê¸° ì‹¤í–‰: ì €ì¥ëœ ë‚ ì”¨ ë¶ˆëŸ¬ì˜¤ê¸°
    const savedWeather = localStorage.getItem('blind-weather-type') || 'none';
    document.getElementById('weatherSelect').value = savedWeather;
    initWeather(savedWeather);

    document.getElementById('weatherSelect').addEventListener('change', (e) => {
        initWeather(e.target.value);
    });

    render();
    animate();
</script>
</body>
</html>
